<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_hr_applicat_vat_form" model="ir.ui.view">
        <field name="name">hr.applicant.vat.form</field>
        <field name="model">hr.applicant</field>
        <field name="inherit_id" ref="hr_recruitment.hr_applicant_view_form"/>
        <field name="arch" type="xml">
            <field name="email_from" position="before">
                <field name="identification_type_id" attrs="{'readonly': [('stage_id', 'in', [5])]}" options="{'no_open': True}"/>
                <field name="province_or_lima" attrs="{'readonly': [('stage_id', 'in', [5])]}"/>
                <field name="vat"/>
                <field name="is_autoemployee" invisible="True"/>
                <field name="has_documents" invisible="True"/>
            </field>
            <xpath expr="//div[hasclass('oe_title')]" position="before">
                <field name="photo" widget="image" class="oe_avatar" force_save="True"/>
            </xpath>
            <xpath expr="//field[@name='stage_id']" position="attributes">
                <attribute name="options">{'clickable': False, 'fold_field': 'fold'}</attribute>
            </xpath>
            <xpath expr="//field[@name='availability']" position="before">
                <field name="first_contract_start" required='0'/>
                <field name="first_contract_end" required='0'/>
            </xpath>
            <xpath expr="//field[@name='availability']" position="after">
                <field name="work_type" required='0'/>
                <field name="company_id" invisible='1'/>
                <field name="parent_id" required='0'/>
                
            </xpath>
            <xpath expr="//header/button[@name='create_employee_from_applicant']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <field name="name" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="partner_name" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="vat" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="email_from" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="email_cc" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="partner_phone" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="partner_mobile" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="type_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="categ_ids" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="job_id" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="department_id" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="user_id" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
            <field name="medium_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="source_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <xpath expr="//field[@name='salary_expected']/ancestor::group[1]/div" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//label[@for='salary_expected']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <!-- <xpath expr="//label[@for='salary_proposed']" position="attributes">
                <attribute name="required">1</attribute>
            </xpath> -->
            <xpath expr="//widget[@name='web_ribbon' and @bg_color='bg-danger']" position="after">
                <widget name="web_ribbon" title="Reinstatement" bg_color="bg-warning" attrs="{'invisible': [('is_reinstatement', '=', False)]}"/>
                <field name="is_reinstatement" invisible="1"/>
            </xpath>
        </field>
    </record>

    <record id="hr_kanban_name_view_applicant" model="ir.ui.view">
        <field name="name">Hr Applicants name kanban</field>
        <field name="model">hr.applicant</field>
        <field name="inherit_id" ref="hr_recruitment.hr_kanban_view_applicant"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@class='o_kanban_record_headings']/b[@class='o_kanban_record_title mt8']/field[@name='partner_name']" position="replace">
                <field name="name"/>
            </xpath>
            <xpath expr="//field[@name='activity_state']" position="after">
                <field name="is_reinstatement" />
            </xpath>

            <xpath expr="//div[@class='ribbon ribbon-top-right' and @attrs]" position="after">
                <div class="ribbon ribbon-top-right" style="pointer-events: none;" attrs="{'invisible': [('is_reinstatement', '=', False)]}">
                    <span class="bg-warning">Reingreso</span>
                </div>
            </xpath>
        </field>
    </record>

    <record id="hr_tree_view_applicant" model="ir.ui.view">
        <field name="name">Applicants</field>
        <field name="model">hr.applicant</field>
        <field name="inherit_id" ref="hr_recruitment.crm_case_tree_view_job"/>
        <field name="arch" type="xml">

            <xpath expr="//tree" position="attributes">
                <attribute name="default_order">create_date desc</attribute>
            </xpath>
            <xpath expr="//field[@name='partner_name']" position="after">
                <field name="vat" string="ID"/>
            </xpath>
            
            <xpath expr="//field[@name='job_id']" position="before">
                <field name="department_id" string="Department"/>
            </xpath>

            <xpath expr="//field[@name='priority']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='categ_ids']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='partner_mobile']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
        </field>
    </record>

    <!-- Nueva vista tipo tree -->
    <record id="view_hr_applicant_tree_payroll" model="ir.ui.view">
        <field name="name">hr.applicant.tree.payroll</field>
        <field name="model">hr.applicant</field>
        <field name="arch" type="xml">
            <tree string="Applicant Contract Request" 
                  editable="bottom"
                  decoration-danger="supervision_data_approved == 'rejected'" 
                  decoration-success="supervision_data_approved == 'approved'"
                  default_order="create_date desc">
                <field name="supervision_data_approved" readonly="1" invisible='1'/>
                <field name="partner_name" readonly="1"/>
                <field name="vat" readonly="1"/>
                <field name="job_id" readonly="1" options="{'no_open': True}" optional="hide"/>
                <field name="department_id" readonly="1" options="{'no_open': True}" optional="hide"/>
                <field name="cost_center_id" readonly="1" decoration-bf="1" options="{'no_open': True}"/>
                <field name="salary_proposed" readonly="1" decoration-bf="1"/>
                <field name="first_contract_start" readonly="1" decoration-bf="1"/>
                <field name="first_contract_end" readonly="1" decoration-bf="1"/>
                <field name="work_type" readonly="1" decoration-bf="1"/>
                <field name="company_id" readonly="1" invisible='1'/>
                <field name="parent_id" readonly="1" decoration-bf="1" options="{'no_open': True}"/>
                <field name="first_contract_type_id" options="{'no_create': True, 'no_open': True}" attrs="{'readonly': [('first_contract_signed', '=', True)]}"/>
                <field name="supervision_data_approved" readonly="1" widget="badge" decoration-info="supervision_data_approved == 'pending'" decoration-warning="supervision_data_approved == 'rejected'" decoration-success="supervision_data_approved == 'approved'"/>
                <field name="write_date" readonly="1" optional="hide"/>
                <field name="first_contract_id" optional="hide"  options="{'no_create': True, 'no_open': True}" groups="base.group_system"/>
                <field name="first_contract_signed" readonly="1" groups="base.group_system" optional="hide"/>
            </tree>
        </field>
    </record>

    <record id="view_hr_applicant_tree_payroll_buttom" model="ir.ui.view">
        <field name="name">hr.applicant.tree.payroll.buttom</field>
        <field name="model">hr.applicant</field>
        <field name="inherit_id" ref="mkt_recruitment.view_hr_applicant_tree_payroll"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="inside">
                <header>
                    <button name="action_approve_supervision_data"
                            type="object"
                            string="Approve"
                            class="btn-secondary"/>
                    <button name="action_reject_supervision_data"
                            type="object"
                            string="Reject"
                            class="btn-secondary"/>
                    <button name="action_restore_supervision_data"
                            type="object"
                            string="Restore"
                            class="btn-secondary"/>
                    <button name="action_send_unsend_first_contract"
                            type="object"
                            string="Enviar/No Enviar Contrato"
                            class="btn-secondary"/>
                    <button name="action_print_first_contract"
                            type="object"
                            string="Imprimir Contrato"
                            class="btn-secondary"/>
                </header>
            </xpath>
            <xpath expr="//tree" position="inside">
                <field name="stage_id" invisible='1'/>
                <field name="first_contract_id" invisible='1'/>
                <field name="first_contract_type_id" invisible='1'/>
                <field name="stage_id" optional="hide" readonly='1'/>
                <field name="send_first_contract" widget="boolean_toggle" optional="hide"
                       attrs="{'invisible': ['|', ('supervision_data_approved', '!=', 'approved'), '|', ('first_contract_id', '=', False), ('first_contract_type_id', '=', False)]}"></field>
                <button name="action_applicant_data_wizard"
                        type="object"
                        string="Ver Info"
                        class="btn-secondary"
                        icon="fa-eye"/>
                <button name="action_approve_supervision_data"
                        type="object"
                        string="Approve"
                        class="btn-primary"
                        icon="fa-check-circle"
                        attrs="{'invisible': ['|', ('stage_id', '!=', 4), ('supervision_data_approved', 'in', ['approved', 'rejected'])]}"/>
                <button name="action_open_first_contract" 
                        type="object" 
                        string="Ver Contrato" 
                        class="btn-primary"
                        attrs="{'invisible': ['|', ('supervision_data_approved', '!=', 'approved'), '|', ('first_contract_id', '=', False), ('first_contract_type_id', '=', False)]}"/>
            </xpath>
        </field>
    </record>


    <record id="view_hr_applicant_search_custom_payroll" model="ir.ui.view">
        <field name="name">hr.applicant.search.custom.payroll</field>
        <field name="model">hr.applicant</field>
        <field name="arch" type="xml">
        <search string="Search Applicants">
            <field name="partner_name" string="Nombre o DNI" filter_domain="['|',('vat','ilike',self),('partner_name','ilike',self)]"/>
            <field name="job_id"/>
            <field name="cost_center_id" string="Centro de Costo"/>

            <filter string="Pending/Approved (Contract not signed)" name="supervision_data_pending_and_approved_no_signed_contract" domain="['|', ('supervision_data_approved', '=', 'pending'), '&amp;', ('stage_id', '=', 4), ('supervision_data_approved', '=', 'approved')]"/>
            <filter string="Pending" name="supervision_data_pending_to_approved" domain="[('supervision_data_approved', '=', 'pending')]"/>
            <filter string="Approved" name="supervision_data_approved" domain="[('supervision_data_approved', '=', 'approved')]"/>
            <filter string="Approved (Contract not signed)" name="supervision_data_approved_no_signed_contract" domain="[('supervision_data_approved', '=', 'approved'), ('stage_id', '=', 4)]"/>
            <filter string="Approved (Contract signed)" name="supervision_data_approved_signed_contract" domain="[('supervision_data_approved', '=', 'approved'), ('stage_id', '=', 5)]"/>
            <filter string="Refused" name="supervision_data_refused" domain="[('supervision_data_approved', '=', 'rejected')]"/>
            <filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>
            <separator/>
            <filter string="Update Date" name="filter_create" date="write_date"/>


            <group expand="0" string="Group By">
            <filter string="Department" name="department" domain="[]" context="{'group_by': 'department_id'}"/>
            <filter string="Responsible" name="responsible" domain="[]" context="{'group_by': 'user_id'}"/>
            <filter string="Job" name="job" domain="[]" context="{'group_by': 'job_id'}"/>
            <filter string="Update Date" name="write_date" context="{'group_by': 'write_date'}"/>
            </group>
        </search>
        </field>
    </record>

    <record id="view_hr_applicant_tracker_tree" model="ir.ui.view">
        <field name="name">hr.applicant.tracker.tree</field>
        <field name="model">hr.applicant</field>
        <field name="arch" type="xml">
            <tree string="Seguimiento de Postulación" default_order="create_date desc">
                <field name="partner_name" />
                <field name="vat" />
                <field name="signed_in" string="1) Ingresó al Odoo"/>
                <field name="data_completed" string="2) Completó Ficha de Datos"/>
                <field name="docs_completed" string="3) Subió Documentos"/>
                <field name="accepted_t_and_c" string="4) Aceptó Términos"/>
                <field name="create_date" readonly="1"/>
                <field name="write_date" readonly="1" optional="hide"/>
            </tree>
        </field>
    </record>

    <!-- Acción que usa esta vista -->
    <record id="action_hr_applicant_tracking_tree" model="ir.actions.act_window">
        <field name="name">Seguimiento de Postulación</field>
        <field name="res_model">hr.applicant</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_hr_applicant_tracker_tree"/>
        <!-- <field name="context">{'search_default_supervision_data_pending_to_approved': 1}</field> -->
        <!-- <field name="context">{'order': 'write_date desc'}</field> -->
        <field name="domain">[('stage_id.id', 'in', [4, 5])]</field>
        <field name="search_view_id" ref="mkt_recruitment.view_hr_applicant_search_custom_payroll" />
    </record>

    <!-- Acción que usa esta vista -->
    <record id="action_hr_applicant_tree_payroll" model="ir.actions.act_window">
        <field name="name">Applicants Contract Request</field>
        <field name="res_model">hr.applicant</field>
        <field name="view_mode">tree</field>
        <field name="domain">[('stage_id.id', 'in', [4, 5]), ('selected_applicant_approved', '=', 'true')]</field>
        <field name="context">{'search_default_supervision_data_pending_and_approved_no_signed_contract': 1}</field>
        <field name="view_id" ref="view_hr_applicant_tree_payroll"/>
        <field name="search_view_id" ref="mkt_recruitment.view_hr_applicant_search_custom_payroll" />
    </record>
</odoo>